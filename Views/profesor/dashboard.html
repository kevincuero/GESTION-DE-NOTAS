{% extends 'profesor/base.html' %}

{% block title %}Dashboard - Profesor{% endblock %}

{% block extra_head %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block main_content %}
  <div class="dashboard-header">
    <h1 class="welcome-message">Bienvenido, {{ usuario['nombre'] }}</h1>
  </div>

  <!-- Gráficos -->
  <div class="charts-section">
    <div class="chart-card">
      <h3>Estudiantes por materia (Barras)</h3>
      <canvas id="barChart"></canvas>
    </div>
    <div class="chart-card">
      <h3>Promedio de notas por materia (Pastel)</h3>
      <canvas id="pieChart"></canvas>
    </div>
    <div class="chart-card">
      <h3>Distribución de notas (Líneas)</h3>
      <canvas id="lineChart"></canvas>
    </div>
  </div>
{% endblock %}

{% block extra_scripts %}
<script>
  // Datos pasados desde Flask
    const labels = JSON.parse('{{ labels|tojson|safe }}');
    const dataEstudiantes = JSON.parse('{{ data_estudiantes|tojson|safe }}');
    const dataPromedios = JSON.parse('{{ data_promedios|tojson|safe }}');
    const notasLabels = JSON.parse('{{ notas_labels|default([])|tojson|safe }}');
    const notasCantidades = JSON.parse('{{ notas_cantidades|default([])|tojson|safe }}');

    // Gráfica de estudiantes por materia (Barras)
    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Estudiantes por materia',
                data: dataEstudiantes,
                backgroundColor: 'rgba(67, 97, 238, 0.7)'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: true } }
        }
    });

    // Gráfica de promedios por materia (Pastel)
    new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                label: 'Promedio de notas',
                data: dataPromedios,
                backgroundColor: [
                    'rgba(67, 97, 238, 0.7)',
                    'rgba(34, 197, 94, 0.7)',
                    'rgba(247, 37, 133, 0.7)',
                    'rgba(255, 195, 0, 0.7)',
                    'rgba(255, 87, 34, 0.7)'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: true } }
        }
    });

    // Gráfica de distribución de notas (Líneas)
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: notasLabels,
            datasets: [{
                label: 'Cantidad de estudiantes',
                data: notasCantidades,
                borderColor: 'rgba(247, 37, 133, 1)',
                backgroundColor: 'rgba(247, 37, 133, 0.2)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: true } }
        }
    });
  </script>
  {% endblock %}